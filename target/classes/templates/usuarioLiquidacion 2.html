<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head th:replace="layout/layout :: head"></head>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/dropzone/5.9.3/dropzone.min.css" />

</head>

<body class="d-flex flex-column min-vh-100">
	<header th:replace="layout/layout :: header"></header>
	<div class="container py-4">
		<div class="row mb-3">
			<div class="col text-center">
				<h3 th:text="${titulo}"></h3>
			</div>
		</div>
		
		
		<div class="form-group row justify-content-center mb-1">
    <form method="get" th:action="@{/usuarioLiquidaciones}" class="row g-2 justify-content-center">

        <label class="col-sm-2 form-label">Empresa</label>
        <div class="col-sm-3">
            <select id="empresaId" name="empresaId" class="form-select form-select-sm">
                <option value="">Todas</option>
                <option th:each="emp: ${listadoEmpresas}"
                        th:text="${emp.razonSocial}"
                        th:value="${emp.id}"
                        th:selected="${empresaId} == ${emp.id}">
                </option>
            </select>
        </div>

        <label class="col-sm-2 form-label">Fecha</label>
        <div class="col-sm-3">
            <input id="fecha" name="fecha" type="month" class="form-control form-control-sm"
                   th:value="${fecha != null ? #temporals.format(fecha, 'yyyy-MM') : #temporals.format(hoy, 'yyyy-MM')}" />
        </div>

        <div class="col-sm-2 d-grid">
            <button type="submit" class="btn btn-primary btn-sm">Buscar</button>
        </div>
    </form>
</div>

		
		
		<div class="row justify-content-center">
			<div class="col-10">
				<div class="card mt-4">

					<div class="card-body">

						<table class="table table-striped table-hover">
							<thead>
								<tr>
									<th>#</th>
									<th>Nombre</th>
									<th>Rut</th>
									<th>Empresa</th>
									<th>Fecha</th>
									<th class="text-center">PDF</th>
									<th class="text-center">Editar</th>
									<th class="text-center">Eliminar</th>
								</tr>
							</thead>
							<tbody>
								<tr th:each="l,cont: ${listadoLiquidacion}">
									<td th:text="${cont.index + 1}"></td>
									<td th:text="${l.usuario.nombre} + ' ' + ${l.usuario.apellido}"></td>
									<td th:text="${l.usuario.rut}"></td>
									<td th:text="${l.empresa.nombre}"></td>
									<td th:text="${l.fecha}"></td>

									
									<td class="text-center"><button th:onclick="verPdfsEP([[${l.id}]]);" class="btn btn-danger btn-sm"><i class="bi bi-file-pdf"></i> PDF</button></td>
									
									<td class="text-center">
										<a id="btnEditarUsuario"
											th:href="@{/editarUsuarioEmpresa/} + ${l.usuario.id}"><i
												class="bi bi-view-list"></i></a>
									</td>
									<td class="text-center">
										<button th:onclick="eliminarLiquidacion([[${l.id}]]);"
											class="btn btn-outline-danger btn-sm"><i class="bi bi-trash3"></i>
										</button>
									</td>
								</tr>
							</tbody>
						</table>

					</div>

				</div>
			</div>
		</div>
	</div>
		<!-- Modal INICIO -->
	<div class="modal fade" id="viewPdfModalEP" tabindex="-1" aria-labelledby="viewPdfModalLabel" aria-hidden="true">
		<div class="modal-dialog modal-xl">
    		<div class="modal-content">
      			<div class="modal-header">
        			<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      			</div>
      			<div class="modal-body">
        			<embed id="idDivModalEP" frameborder="0" width="100%" height="600px">
      			</div>
    		</div>
  		</div>
	</div>
	<!-- Modal FIN -->
	
	<script th:src="@{/js/liquidacion.js}"></script>
	<footer th:replace="layout/layout :: footer"></footer>
</body>

</html>