<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="layout/layout :: head"></head>
<body class="d-flex flex-column min-vh-100">
<header th:replace="layout/layout :: header"></header>

<main class="flex-grow-1">
    <div class="container py-4">

    <!-- Título -->
    <div class="row mb-4">
        <div class="col text-center">
            <h3 th:text="${titulo}" class="fw-bold text-primary border-bottom pb-2"></h3>
        </div>
    </div>

    <!-- Filtro empresa + botón crear -->
    <div class="row justify-content-center mb-3">
        <div class="col-lg-10">
            <div class="card shadow-sm border-0">
                <div class="card-body">
                    <form th:action="@{/listadoUsuariosEmpresa}" method="get" class="row g-3 align-items-end">

                        <!-- Empresa -->
                        <div class="col-md-6">
                            <label for="empresaId" class="form-label fw-semibold">
                                <i class="fas fa-building text-primary"></i> Empresa
                            </label>
                            <select id="empresaId" name="empresaId" class="form-select form-select-sm" onchange="this.form.submit()">
                                <option value="" th:if="${#lists.size(listadoEmpresas) > 1}">-- Todas --</option>
                                <option th:each="emp : ${listadoEmpresas}"
                                        th:value="${emp.id}"
                                        th:text="${emp.razonSocial}"
                                        th:selected="${emp.id == empresaIdSeleccionada}">
                                </option>
                            </select>
                        </div>

                        <!-- Botón crear -->
                        <div class="col-md-3 offset-md-3 d-grid text-end">
                            <a th:href="@{/crearUsuarioEmpresa}" class="btn btn-success btn-sm rounded-pill">
                                <i class="fas fa-plus-circle"></i> Crear Usuario
                            </a>
                        </div>

                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Tabla -->
    <div class="row justify-content-center">
        <div class="col-lg-10">
            <div class="card shadow-sm border-0">
                <div class="card-body table-responsive">
                    <table class="table table-hover align-middle table-striped">
                        <thead class="bg-primary text-white">
                            <tr>
                                <th>#</th>
                                <th><i class="fas fa-user"></i> Nombre</th>
                                <th>Apellido</th>
                                <th><i class="fas fa-id-card"></i> Rut</th>
                                <th><i class="fas fa-envelope"></i> Email</th>
                                <th><i class="fas fa-building"></i> Empresa</th>
                                <th><i class="fas fa-toggle-on"></i> Estado</th>
                                <th class="text-center"><i class="fas fa-edit"></i> Editar</th>
                                <th class="text-center"><i class="fas fa-trash"></i> Eliminar</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr th:each="eu,cont: ${listadoUsuarios}">
                                <td th:text="${cont.index + 1}"></td>
                                <td th:text="${eu.usuario.nombre}"></td>
                                <td th:text="${eu.usuario.apellido}"></td>
                                <td th:text="${eu.usuario.rut}"></td>
                                <td th:text="${eu.usuario.email}"></td>
                                <td th:text="${eu.empresa.nombre}"></td>
                                <td>
                                    <span th:if="${eu.usuario.estado} == 0" class="badge bg-warning text-dark">Pendiente</span>
                                    <span th:if="${eu.usuario.estado} == 1" class="badge bg-success">Activo</span>
                                    <span th:if="${eu.usuario.estado} == 2" class="badge bg-secondary">Deshabilitado</span>
                                </td>
                                <td class="text-center">
                                    <a th:href="@{/editarUsuarioEmpresa/{id}(id=${eu.usuario.id},empresaId=${eu.empresa.id})}" 
                                       class="btn btn-outline-primary btn-sm rounded-pill" title="Editar">
                                        <i class="fas fa-edit"></i>
                                    </a>
                                </td>
                                <td class="text-center">
                                    <button th:onclick="eliminarUsuarioEmpresa([[${eu.usuario.id}]],[[${eu.empresa.id}]]);" 
                                            class="btn btn-outline-danger btn-sm rounded-pill" title="Eliminar">
                                        <i class="fas fa-trash-alt"></i>
                                    </button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

</div>

</main>

<script th:src="@{/js/usuario.js}"></script>

<footer th:replace="layout/layout :: footer"></footer>
</body>
</html>
