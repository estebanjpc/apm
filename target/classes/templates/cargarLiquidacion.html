<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="layout/layout :: head"></head>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/dropzone/5.9.3/dropzone.min.css" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/dropzone/5.9.3/dropzone.min.js"></script>
<meta name="_csrf" th:content="${_csrf.token}" />
<meta name="_csrf_header" th:content="${_csrf.headerName}" />
</head>
<body class="d-flex flex-column min-vh-100">

<header th:replace="layout/layout :: header"></header>

<main class="flex-grow-1">
    <div class="container py-4">

    <!-- Título -->
    <div class="row mb-4">
        <div class="col text-center">
            <h3 th:text="${titulo}" class="fw-bold text-primary border-bottom pb-2"></h3>
        </div>
    </div>

    <!-- Filtros -->
    <div class="row justify-content-center mb-4">
        <div class="col-lg-10">
            <div class="card shadow-sm border-0">
                <div class="card-body">
                    <form method="get" th:action="@{/subidaArchivos}" class="row g-3 align-items-end">

                        <!-- Empresa -->
                        <div class="col-md-5">
                            <label for="empresaId" class="form-label fw-semibold">
                                <i class="fas fa-building text-primary"></i> Empresa
                            </label>
                            <select id="empresaId" name="empresaId" class="form-select form-select-sm" required>
                                <option value="" th:if="${#lists.size(listadoEmpresas) > 1}">Seleccione</option>
                                <option th:each="emp: ${listadoEmpresas}"
                                        th:text="${emp.razonSocial}"
                                        th:value="${emp.id}">
                                </option>
                            </select>
                        </div>

                        <!-- Fecha -->
                        <div class="col-md-5">
                            <label for="fecha" class="form-label fw-semibold">
                                <i class="fas fa-calendar-alt text-primary"></i> Fecha
                            </label>
                            <input id="fecha" name="fecha" type="month" class="form-control form-control-sm"
                                   th:value="${#temporals.format(hoy, 'yyyy-MM')}" />
                        </div>

                        <!-- Botón Buscar -->
                        <div class="col-md-2 d-grid">
                            <button type="submit" class="btn btn-primary btn-sm rounded-pill">
                                <i class="fas fa-search"></i> Buscar
                            </button>
                        </div>

                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Dropzone -->
    <div class="row justify-content-center">
        <div class="col-lg-10">
            <div class="card shadow-sm border-0">
                <div class="card-body">
                    <div id="dropzoneDiv" class="dropzone border rounded p-4 bg-light text-center">
                        <div class="dz-message text-muted">
                            <i class="fas fa-cloud-upload-alt fa-2x text-primary mb-2"></i>
                            <p>Arrastra y suelta los archivos aquí o haz clic para seleccionarlos.</p>
                        </div>
                    </div>
                    <div class="text-center mt-4">
                        <button id="btnAceptar" class="btn btn-primary rounded-pill px-4">
                            <i class="fas fa-check-circle"></i> Aceptar
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

</div>

</main>

<!-- Modal Resumen -->

<div class="modal fade" id="modalResumen" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content shadow-lg border-0">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title fw-bold"><i class="fas fa-list-alt"></i> Resumen de subida</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body" id="resumenContent"></div>
            <div class="modal-footer border-0">
                <button type="button" class="btn btn-secondary rounded-pill" data-bs-dismiss="modal">
                    <i class="fas fa-times-circle"></i> Cerrar
                </button>
            </div>
        </div>
    </div>
</div>

<script th:src="@{/js/dropzone.js}"></script>
<script th:src="@{/js/liquidacion.js}"></script>
<footer th:replace="layout/layout :: footer"></footer>
</body>
</html>
