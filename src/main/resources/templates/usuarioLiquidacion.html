<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head th:replace="layout/layout :: head"></head>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/dropzone/5.9.3/dropzone.min.css" />

</head>

<body class="d-flex flex-column min-vh-100">
	<header th:replace="layout/layout :: header"></header>

	<main class="flex-grow-1">
		<div class="container py-4">

			<!-- TÃ­tulo -->
			<div class="row mb-4">
				<div class="col text-center">
					<h3 th:text="${titulo}" class="fw-bold text-primary border-bottom pb-2"></h3>
				</div>
			</div>

			<!-- Filtros -->
			<div class="row justify-content-center mb-3">
				<div class="col-lg-10">
					<div class="card shadow-sm border-0">
						<div class="card-body">
							<form method="get" th:action="@{/usuarioLiquidaciones}" class="row g-3 align-items-end">

								<div class="col-md-4">
									<label for="empresaId" class="form-label fw-semibold">
										<i class="fas fa-building text-primary"></i> Empresa
									</label>
									<select id="empresaId" name="empresaId" class="form-select form-select-sm">
										<option value="" th:if="${#lists.size(listadoEmpresas) > 1}">Todas</option>
										<option th:each="emp: ${listadoEmpresas}" th:text="${emp.razonSocial}"
											th:value="${emp.id}" th:selected="${empresaId} == ${emp.id}">
										</option>
									</select>
								</div>

								<div class="col-md-4">
									<label for="fecha" class="form-label fw-semibold">
										<i class="fas fa-calendar-alt text-primary"></i> Fecha
									</label>
									<input id="fecha" name="fecha" type="month" class="form-control form-control-sm"
										th:value="${fecha != null ? #temporals.format(fecha, 'yyyy-MM') : #temporals.format(hoy, 'yyyy-MM')}" />
								</div>

								<div class="col-md-2 d-grid ms-auto">
									<button type="submit" class="btn btn-primary btn-sm rounded-pill">
										<i class="fas fa-search"></i> Buscar
									</button>
								</div>

							</form>
						</div>
					</div>
				</div>
			</div>

			<!-- Tabla -->
			<div class="row justify-content-center">
				<div class="col-lg-10">
					<div class="card shadow-sm border-0">
						<div class="card-body table-responsive">
							<table class="table table-hover align-middle table-striped">
								<thead class="bg-primary text-white">
									<tr>
										<th>#</th>
										<th>Nombre</th>
										<th>Rut</th>
										<th>Empresa</th>
										<th>Fecha</th>
										<th class="text-center">PDF</th>
										<th class="text-center">Eliminar</th>
									</tr>
								</thead>
								<tbody>
									<tr th:each="l,cont: ${listadoLiquidacion}">
										<td th:text="${cont.index + 1}"></td>
										<td th:text="${l.usuario.nombre} + ' ' + ${l.usuario.apellido}"></td>
										<td th:text="${l.usuario.rut}"></td>
										<td th:text="${l.empresa.nombre}"></td>
										<td th:text="${l.fecha}"></td>

										<td class="text-center">
											<button th:onclick="verPdfsEP([[${l.id}]]);"
												class="btn btn-outline-danger btn-sm rounded-pill"
												data-bs-toggle="tooltip" title="Ver PDF">
												<i class="fas fa-file-pdf"></i>
											</button>
										</td>

										<td class="text-center">
											<button th:onclick="eliminarLiquidacion([[${l.id}]]);"
												class="btn btn-outline-danger btn-sm rounded-pill"
												data-bs-toggle="tooltip" title="Eliminar">
												<i class="fas fa-trash-alt"></i>
											</button>
										</td>
									</tr>
								</tbody>
							</table>
						</div>
					</div>
				</div>
			</div>

		</div>
	</main>

	<!-- Modal PDF -->
	<div class="modal fade" id="viewPdfModalEP" tabindex="-1" aria-hidden="true">
		<div class="modal-dialog modal-xl modal-dialog-centered">
			<div class="modal-content shadow-lg border-0">
				<div class="modal-header bg-primary text-white">
					<h5 class="modal-title fw-bold"><i class="fas fa-file-pdf"></i> Vista de PDF</h5>
					<button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
				</div>
				<div class="modal-body p-0">
					<embed id="idDivModalEP" frameborder="0" width="100%" height="600px">
				</div>
			</div>
		</div>
	</div>

	<script th:src="@{/js/liquidacion.js}"></script>
	<footer th:replace="layout/layout :: footer"></footer>
</body>

</html>