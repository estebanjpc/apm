<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="layout/layout :: head"></head>
<body class="d-flex flex-column min-vh-100">

<header th:replace="layout/layout :: header"></header>

<main class="flex-grow-1">
    <div class="container py-4">
        <!-- TÃ­tulo -->
        <div class="row mb-4">
            <div class="col text-center">
                <h3 th:text="${titulo}" 
                    class="fw-bold text-primary border-bottom pb-2">
                </h3>
            </div>
        </div>

        <!-- Tabla -->
        <div class="row justify-content-center">
            <div class="col-12">
                <div class="card shadow-sm border-0">
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-hover align-middle table-striped">
                                <thead class="bg-primary text-white">
                                    <tr>
                                        <th>#</th>
                                        <th><i class="fas fa-user"></i> Nombre</th>
                                        <th><i class="fas fa-id-card"></i> Rut</th>
                                        <th><i class="fas fa-building"></i> Empresa</th>
                                        <th><i class="fas fa-calendar-alt"></i> Fecha</th>
                                        <th class="text-center"><i class="fas fa-file-pdf"></i> PDF</th>
                                        <th class="text-center"><i class="fas fa-envelope"></i> Email</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr th:each="l, cont: ${listadoLiquidacion}">
                                        <td th:text="${cont.index + 1}"></td>
                                        <td th:text="${l.usuario.nombre} + ' ' + ${l.usuario.apellido}"></td>
                                        <td th:text="${l.usuario.rut}"></td>
                                        <td th:text="${l.empresa.nombre}"></td>
                                        <td th:text="${#strings.capitalize(#dates.format(l.fecha,'MMMM - yyyy'))}"></td>
                                        <td class="text-center">
                                            <button th:onclick="verPdfsEP([[${l.id}]]);"
                                                    class="btn btn-outline-danger btn-sm rounded-pill"
                                                    data-bs-toggle="tooltip" title="Ver PDF">
                                                <i class="fas fa-file-pdf"></i>
                                            </button>
                                        </td>
                                        <td class="text-center">
                                            <a th:href="@{/enviarPdfEmail/} + ${l.id}" 
                                               class="btn btn-outline-success btn-sm rounded-pill"
                                               data-bs-toggle="tooltip" title="Enviar por Email">
                                                <i class="fas fa-paper-plane"></i>
                                            </a>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</main>

<!-- Modal PDF -->
<div class="modal fade" id="viewPdfModalEP" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content card shadow">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title"><i class="fas fa-file-pdf"></i> Visualizador PDF</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body p-0">
                <embed id="idDivModalEP" frameborder="0" width="100%" height="600px">
            </div>
        </div>
    </div>
</div>

<script th:src="@{/js/liquidacion.js}"></script>
<script>
    // Inicializar tooltips Bootstrap
    document.addEventListener("DOMContentLoaded", () => {
        const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
        tooltipTriggerList.map(el => new bootstrap.Tooltip(el))
    });
</script>

<footer th:replace="layout/layout :: footer"></footer>
</body>
</html>
